---
typora-copy-images-to: img\04
---

# Node.js å†…ç½®æ¨¡å—

 Node.js æœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œæ­£æ˜¯è¿™äº›å†…ç½®æ¨¡å—ï¼Œæä¾›äº† Node.js å’Œæ“ä½œç³»ç»Ÿäº¤äº’çš„èƒ½åŠ›ï¼Œæ¥ä¸‹æ¥å°±æ¥äº†è§£ä¸€ä¸‹å®ƒä»¬â€¦â€¦

## â˜… Node.js å†…ç½®æ¨¡å—

### â—‡ Node.js çš„ç³»ç»Ÿæ¶æ„å›¾

åœ¨è®²è§£ Node.js å†…ç½®æ¨¡å—ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸€å¼ ç³»ç»Ÿæ¶æ„å›¾ï¼š

![img](img/04/nojs-system-diagram-by-busyrich.jpg)

è¿™å¼ å›¾æ˜¯åœ¨ç½‘ä¸Šæ‰¾çš„ï¼Œå®ƒæ¯”è¾ƒæ¸…æ™°çš„è¡¨è¿°äº† Node.js çš„ç³»ç»Ÿæ¶æ„

å›é¡¾å®˜ç½‘å¯¹ Node.js çš„ä¸¤å¥è¯æè¿°ï¼š

* Node.js æ˜¯ä¸€ä¸ªåŸºäº **Chrome V8 å¼•æ“**çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚
* Node.js ä½¿ç”¨äº†ä¸€ä¸ª**äº‹ä»¶é©±åŠ¨**ã€**éé˜»å¡å¼ I/O** çš„æ¨¡å‹ï¼Œä½¿å…¶è½»é‡åˆé«˜æ•ˆã€‚

è€Œè¿™ä¸¤å¥è¯å°±åœ¨ä¸Šè¾¹çš„é‚£å¼ æ¶æ„å›¾é‡Œè¾¹æœ‰æ‰€ä½“ç°ï¼š

ç¬¬ä¸€å¥è¯ä½“ç°åœ¨å·¦è¾¹é‚£éƒ¨åˆ†ï¼Œå³é‚£ä¸¤åˆ—ä¸œè¥¿ã€‚

applicationå°±æ˜¯æˆ‘ä»¬æ‰€å†™çš„ Node.js ä»£ç ï¼Œç„¶åå®ƒé€šè¿‡V8å¼•æ“æ¥è¿è¡Œï¼Œè€Œé‡Œè¾¹æ¶‰åŠåˆ°å¯¹æ“ä½œç³»ç»Ÿçš„è°ƒç”¨ï¼Œè¿™ä¸€éƒ¨åˆ†å°±ä¼šç”±v8å¼•æ“å¸®æˆ‘ä»¬è½¬å‘åˆ°æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿå±‚é¢ï¼Œä¸›æ“ä½œç³»ç»Ÿå±‚é¢å¾—åˆ°è¿”å›ç»“æœä¹‹åï¼Œå†é€šè¿‡v8å¼•æ“è¿”å›åˆ° JS é‡Œè¾¹å»ã€‚

è€Œè¿™å°±æ˜¯é’ˆå¯¹ Node.js çš„ç¬¬ä¸€å¥è¯çš„è¡¨ç°äº†ã€‚

æ¥åˆ°å³è¾¹è¿™éƒ¨åˆ†ï¼Œè¿™æ˜¯å…³äºç¬¬äºŒå¥è¯çš„è¡¨ç°ã€‚

è¿™ä¸€éƒ¨åˆ†ï¼Œä¸‹èŠ‚è¯¾å†è®²ï¼Œç°åœ¨å°±å…ˆå¿½ç•¥æ‰å®ƒï¼

### â—‡å‰–æå†…ç½®æ¨¡å—

ä» JS åˆ° V8 å†åˆ° æ“ä½œç³»ç»Ÿ çš„è¿™ä¸ªèƒ½åŠ›ï¼Œæœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†éƒ½æ˜¯é€šè¿‡ Node.js çš„å†…ç½®æ¨¡å—æ¥æä¾›çš„ï¼Œå› æ­¤æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ Node.js çš„ä¸€äº›å†…ç½®æ¨¡å—ã€‚

æ¥åˆ° Node.js å®˜æ–¹ç½‘ç«™çš„è¿™ä¹ˆä¸€ä¸ªæ–‡æ¡£é¡µé¢ï¼š

**â¹ï¼š**[Index - Node.js v12.12.0 Documentation](https://nodejs.org/dist/latest-v12.x/docs/api/)

å…¶é‡Œè¾¹ç½—åˆ—äº† Node.js æ‰€æœ‰çš„å†…ç½®æ¨¡å—ï¼Œæ¯”å¦‚è¯´ï¼š

1. å…¸å‹çš„ File System ,ä¸€ä¸ªæ“ä½œç³»ç»Ÿå±‚é¢çš„ç”¨äºæ“ä½œæ–‡ä»¶çš„APIï¼Œæˆ‘ä»¬çš„ Node.js é€šè¿‡è°ƒç”¨ File System API å°±å¯ä»¥æ“ä½œæˆ‘ä»¬æ“ä½œç³»ç»Ÿä¸Šçš„ æ–‡ä»¶äº†ã€‚
2. Netæ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç½‘ç»œèƒ½åŠ›
3. Processï¼Œè®°è½½ç€ Node.js è¿™ä¸ªè¿›ç¨‹çš„ä¸€äº›ä¿¡æ¯
4. OSï¼Œæ¥ä¸‹æ¥ç”¨äºå½“ä¾‹å­è®²çš„ä¸€ä¸ªæ¨¡å—ï¼Œè¯¥å†…ç½®æ¨¡å—å¦‚åŒå®ƒçš„åå­—ä¸€æ ·ï¼Œå°±æ˜¯ç”¨äºè¡¨ç¤ºä¸€äº›è·Ÿæ“ä½œç³»ç»Ÿç›¸å…³çš„ä¸€äº›äº‹æƒ…ã€‚æˆ‘ä»¬å¯ä»¥çœ‹çœ‹OSæ¨¡å—æœ‰å“ªäº›å‡½æ•°ï¼Œæˆ–è€…è¯´æ˜¯æ–¹æ³•ï¼ˆå‡½æ•°åœ¨å¯¹è±¡é‡Œè¾¹å«åšæ–¹æ³•ï¼‰ï¼Œå¦‚ `os.arch()` è¡¨æ˜äº†æ“ä½œç³»ç»Ÿçš„æ¶æ„ï¼ˆCPUæ¶æ„ï¼‰ï¼Œå¦‚32ä½ã€64ä½ã€armï¼Œæˆ‘è¿™å°å°±æ˜¯ x64çš„ã€ `os.cpus()` å¾—åˆ°äº† Node.js æ‰€è¿è¡Œçš„è¿™å°ç”µè„‘é‡Œè¾¹æœ‰å¤šå°‘ä¸ªcpuä»¥åŠæœ‰å‡ ä¸ªæ ¸ï¼Œå‚æ•°æ˜¯æ€æ ·å­çš„, å¦‚æˆ‘çš„æ˜¯1ä¸ªCPU4æ ¸çš„ã€ `os.freemem()` è¡¨æ˜å½“å‰æ“ä½œç³»ç»Ÿè¿˜æœ‰å¤šå°‘ç©ºä½™å†…å­˜â€¦â€¦

æ€»ä¹‹ï¼Œè¿™å…¨éƒ½æ˜¯ä¸€äº›æ“ä½œç³»ç»Ÿå±‚é¢çš„ä¸€äº›æ•°æ®å’Œèƒ½åŠ›

é‚£ä¹ˆæˆ‘ä»¬çš„ JS æ˜¯æ€ä¹ˆè·å–åˆ°å®ƒä»¬çš„å‘¢ï¼Ÿ

å…¶å®æˆ‘ä»¬å‡­å°è±¡éƒ½çŸ¥é“ JS æ˜¯æ²¡æœ‰ä»€ä¹ˆè·å–è¿™äº›ä¿¡æ¯çš„èƒ½åŠ›çš„

é‚£ä¹ˆè¿™äº›èƒ½åŠ›æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å‰–æä¸€ä¸‹ Node.js æ˜¯æ€ä¹ˆåšçš„

### â—‡è°ƒç”¨ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰

ä¸ºäº†å‰–æ Node.js çš„å†…ç½®æ¨¡å—ï¼Œæˆ‘ä»¬å¾—æ‰“å¼€ Node.js çš„æºç æ‰è¡Œï¼Œä¸ºå•¥è¦çœ‹æºç å‘¢ï¼Ÿâ€”â€”å› ä¸ºä¸çœ‹æºç çš„è¯ï¼Œæ˜¯ä¸å¤ªèƒ½è®²æ¸…æ¥š  JS æ˜¯å¦‚ä½•å…·å¤‡è·å–åˆ°è¿™äº›ä¿¡æ¯çš„èƒ½åŠ›çš„ã€‚

æºç ä¸‹è½½ï¼š[Release 2019-10-11, Version 12.12.0 (Current), @BridgeAR Â· nodejs/node](https://github.com/nodejs/node/releases/tag/v12.12.0)

> åƒä¸‡ä¸è¦æŠŠæ•´ä¸ªnodeä»“åº“ç»™ä¸‹è½½ä¸‹æ¥ï¼Œå¦‚æœä½ è¿™æ ·åšäº†ï¼Œé‚£ä¹ˆå°†ä¼šä¸‹è½½850Må·¦å³çš„ä¸œè¥¿ï¼Œè€Œä¸Šè¾¹è¿™ä¸ªé“¾æ¥æ‰€ä¸‹è½½çš„æºç ï¼Œåªæœ‰80å¤šMå“ˆ!

æ‰“å¼€ä¸‹è½½ä¸‹æ¥çš„æºç ä¹‹åï¼Œä½ ä¼šå‘ç°å®ƒçš„ç›®å½•ç»“æ„éå¸¸çš„å¤æ‚ï¼

æ‰€æœ‰çš„å†…ç½®æ¨¡å—éƒ½åœ¨ `lib` è¿™ä¸ªç›®å½•é‡Œè¾¹ã€‚

æ¥ä¸‹æ¥ç ”ç©¶ä¸€ä¸‹ `os` è¿™ä¸ªå†…ç½®æ¨¡å—ï¼š

1. æ‰“å¼€ `lib/os.js` æ–‡ä»¶ï¼Œå®šä½åˆ°è¿™ä¸ªæ¨¡å—çš„è¾“å‡ºï¼Œå³ `exports` ï¼Œæˆ‘ä»¬åœ¨æ–‡æ¡£é‡Œè¾¹æ‰€çœ‹åˆ°çš„é‚£äº›æ–¹æ³•ï¼Œè‡ªç„¶éƒ½åœ¨è¿™ä¸ªè¾“å‡ºé‡Œè¾¹ã€‚

2. ç ”ç©¶ `cpus` è¿™ä¸ªæ–¹æ³•

cpusï¼Œå®ƒæ˜¯ä¸ªå‡½æ•°ï¼Œä½†åœ¨æ–‡æ¡£ä¸Šçš„è¡¨ç°å®ƒæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œä¸è¿‡è¿™å¹¶ä¸é‡è¦ï¼Œä¸€ä¸ªç§°å‘¼è€Œå·²ã€‚

``` js
function cpus() {
  // [] is a bugfix for a regression introduced in 51cea61
  const data = getCPUs() || [];
  const result = [];
  let i = 0;
  while (i < data.length) {
    result.push({
      model: data[i++],
      speed: data[i++],
      times: {
        user: data[i++],
        nice: data[i++],
        sys: data[i++],
        idle: data[i++],
        irq: data[i++]
      }
    });
  }
  return result;
}
```

è¯¥å‡½æ•°è°ƒç”¨ `getCPUs` ï¼Œç„¶åæŠŠè¿”å›ç»“æœç»„è£…ä¸€å±‚ä¹‹åï¼Œå†è¿”å›å‡ºå».

é‚£ä¹ˆè¿™ `getCPUs` æ¥è‡ªå“ªå„¿å‘¢ï¼Ÿ

å®ƒæ˜¯é€šè¿‡è°ƒç”¨ `internalBinding('os')` ï¼Œç„¶åä»æ‰€è¿”å›çš„ç»“æœé‡Œè¾¹å–å‡ºæ¥çš„ã€‚

é‚£ä¹ˆ `internalBinding` åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

å®ƒæ˜¯å»è°ƒç”¨æˆ‘ä»¬ Node.js v8 å±‚é¢çš„ä¸€äº›æ–¹æ³•ï¼Œç„¶åv8ä¼šå¸®æˆ‘ä»¬å»è·å–è¿™ä¸ªCPUçš„ä¸€äº›ä¿¡æ¯ã€‚

> ä½ å¯ä»¥æŠŠ Node.js çœ‹åšæ˜¯ä¸ªæµè§ˆå™¨ï¼Œè€Œè¿™æ ·ä¼šå¥½ç†è§£ä¸€ç‚¹ï¼Œæ¯•ç«Ÿæˆ‘ä»¬ç»å¸¸è·Ÿæµè§ˆå™¨æ‰“äº¤é“ï¼

é‚£ä¹ˆå¦‚ä½•å»çœ‹ `internalBinding('os')` æ‰€å¯¹åº”çš„ä»£ç å‘¢ï¼Ÿ

è¿™ä¸ªå°±åœ¨æˆ‘ä»¬çš„ `src` ç›®å½•é‡Œè¾¹äº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç›®å½•å…¨éƒ½æ˜¯ä¸€äº› c++ æ–‡ä»¶ï¼Œæ‰¾åˆ° `node_os.cc` ï¼Œå¹¶æ‰“å¼€å®ƒ

å¯ä»¥çœ‹åˆ°æ³¨é‡Šå†™å¾—éå¸¸å¥½ï¼Œå¯è§è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¸“ä¸šçš„æœºæ„å“ˆï¼

ä»£ç è™½ç„¶éå¸¸å¤šï¼Œä½†æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ° `getCPUs` å°±å¥½äº†ï¼ŒæŸ¥æ‰¾å¯çŸ¥ï¼Œå®ƒåœ¨ä¸€ä¸ª `Initialize` åˆå§‹åŒ–æ–¹æ³•é‡Œè¾¹ï¼š

``` c++
void Initialize() {
  Environment* env = Environment::GetCurrent(context);
  env->SetMethod(target, "getCPUs", GetCPUInfo);
}
```

envæ‰§è¡Œä¸€ä¸ª `SetMethod` æ–¹æ³•ï¼Œç„¶åä¼ ä¸€ä¸ª `target` è¿›å»ï¼Œç„¶ååˆå®šä¹‰äº† `getCPUs` ï¼ŒæŒ‡å‘äº† `GetCPUInfo` è¿™å †ä¸œè¥¿ã€‚

``` c++
env->SetMethod(target, "getCPUs", GetCPUInfo);
```

è¯´ç™½äº†ï¼Œä¸Šè¾¹è¿™è¡Œä»£ç ï¼Œå°±æ˜¯åœ¨å®šä¹‰c++æ¨¡å—çš„è¾“å‡ºï¼Œè€Œè¿™ä¸ªè¾“å‡ºï¼Œå®ƒæ˜¯ä½¿ç”¨äº† v8 è¿™ä¸ªåº“å¤„ç†ä¹‹åï¼Œé‚£ä¹ˆè¾“å‡ºçš„è¿™äº›ä¸œè¥¿ï¼Œæœ€ç»ˆéƒ½ä¼šåœ¨ JS é‡Œè¾¹ç›´æ¥è¢«è°ƒç”¨åˆ°ï¼

æ€»ä¹‹ï¼Œè¿™ä¸ªæ–‡ä»¶çš„ä»£ç éƒ½æ˜¯v8çš„ä¸€äº›èƒ½åŠ›ï¼Œå›é¡¾å¤´æ¥çœ‹ `GetCPUInfo` è¿™ä¸ªæ–¹æ³•åšäº†ä»€ä¹ˆäº‹æƒ…ï¼š

``` c++
static void GetCPUInfo(const FunctionCallbackInfo<Value>& args) { 
   Environment* env = Environment:: GetCurrent(args); 
   //â€¦â€¦
}

```

`FunctionCallbackInfo` è¿™ä¸ªå‚æ•°éå¸¸é•¿ï¼Œè¿™æ˜¯v8ç”¨æ¥è½¬æ¢ JS å‚æ•°çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå³æˆ‘ä»¬ JS è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ‰€ä¼ çš„å‚æ•°æœ€ç»ˆå¯ä»¥åœ¨ `args` é‡Œè¾¹å–åˆ°ï¼

å½“ç„¶ï¼Œæˆ‘ä»¬è¿™ä¸ª `getCPUs` æ–¹æ³•å…¶å®æ˜¯å’©æœ‰ä»»ä½•å‚æ•°çš„ï¼Œæ‰€ä»¥è¿™å¹¶ä¸ä¼šæ¶‰åŠå»å‚æ•°çš„æ“ä½œ

ç»§ç»­çœ‹ä¸‹å»ï¼Œä½ ä¼šå¾ˆç›´è§‚çš„æ„Ÿå—åˆ°æœ€ç»ˆéƒ½ä¼šé€šè¿‡ `uv_free_cpu_info(cpu_infos, count);` å»c++çš„ä¸€äº›åº•å±‚ä»£ç é‡Œè¾¹è·å–åˆ°äº†æˆ‘ä»¬çš„cpuä¿¡æ¯ã€‚

``` C
args.GetReturnValue().Set(Array::New(isolate, result.data(), result.size()));
```

å¹¶ä¸”æœ€åé€šè¿‡è°ƒç”¨v8çš„æ¥å£ `GetReturnValue().Set()` , ç„¶åæŠŠæ‰§è¡Œç»“æœè½¬å˜æˆäº†v8çš„å˜é‡ï¼Œè€Œè¿™ä¸ªv8å˜é‡æœ€ç»ˆåˆä¼šå˜æˆæˆ‘ä»¬çš„ JS å˜é‡ï¼æœ€ç»ˆå®ç°äº†ï¼Œc++åˆ° JS çš„å˜é‡è½¬æ¢ã€‚

å›åˆ° `os.js` è¿™ä¸ªå¤–è¾¹æ¥ï¼Œ `getCPUs()` æ‹¿åˆ°äº†cpuä¿¡æ¯ `data` ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ª `data` å†è¿›è¡Œç»„è£…ï¼Œæœ€åè¿”å›åˆ° Node.js åº”ç”¨é‡Œè¾¹å»å“ˆï¼

ä»¥ä¸Šå°±æ˜¯æ•´ä¸ªå†…ç½®æ¨¡å—è°ƒç”¨çš„ä¸€ä¸ªé€šè·¯å•¦ï¼

ä»æˆ‘ä»¬çš„ Node.js åº”ç”¨ä»£ç å¼€å§‹ï¼Œè°ƒç”¨åˆ°æˆ‘ä»¬ Node.js çš„åº•å±‚åº“ï¼Œç„¶åè¿™ä¸ªå†…ç½®æ¨¡å—åˆå»è°ƒç”¨ Node.js é‡Œè¾¹çš„C++æ¨¡å—ï¼Œc++æ¨¡å—åˆé€šè¿‡c++çš„ä¸€äº›è°ƒç”¨ï¼Œå³è°ƒç”¨æˆ‘ä»¬çš„libuvï¼Œæ€»ä¹‹å°±æ˜¯è°ƒç”¨c++çš„ä¸€äº›åº•å±‚å‡½æ•°ï¼Œç„¶åæŠŠå¾—åˆ°çš„ç»“æœè¿”å›åˆ°æˆ‘ä»¬ Node.js çš„å†…ç½®æ¨¡å—ï¼Œç„¶åå†è¿”å›åˆ°  Node.js åº”ç”¨ä»£ç ã€‚

æ€»ä¹‹ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ•´ä¸ªå†…ç½®æ¨¡å—è°ƒç”¨çš„é€šè·¯ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å®ç°äº† Node.js å’Œæ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªäº¤äº’ã€‚

![1571024017403](img/04/1571024017403.png)

> é€šè¿‡bindingï¼Œè®© JS æœ‰äº†ä¸ C++ æ²Ÿé€šçš„èƒ½åŠ›ï¼ŒJSè¯´ã€Œæˆ‘æƒ³åƒé›ªç³•ã€ï¼ŒC++ã€Œå¸®ä½ å¼„ä¸ªé›ªç³•å‡ºæ¥ã€ã€‚çªç„¶è§‰å¾— JS æ˜¯ä¸€ç§å¾ˆå£°æ˜å¼ç¼–ç¨‹çš„ä½“ç°å‘€ï¼Œå³ç«™åœ¨è¯­è¨€è¿™ä¸ªå±‚é¢ä¸Šï¼Œ JS å‘Šè¯‰ C++ æˆ‘è¦ä»€ä¹ˆï¼Œç„¶åè®©C++ å»åš.

**â¹ï¼š**[å£°æ˜å¼ç¼–ç¨‹å’Œå‘½ä»¤å¼ç¼–ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/22285830)

ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°äº†è¿™æ ·ä¸€ä¸ªé€šè·¯ï¼š

applicationğŸ‘‰ğŸ‘‰ğŸ‘‰V8ğŸ‘‰ğŸ‘‰ğŸ‘‰Node.js bindingsğŸ‘‰ğŸ‘‰ğŸ‘‰V8ğŸ‘‰ğŸ‘‰ğŸ‘‰application

è€Œè¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ Node.js å†…ç½®æ¨¡å—çš„è¿è¡Œæœºåˆ¶ã€‚

### â—‡é€šçŸ¥ï¼ˆè‡ªåº•å‘ä¸Šï¼‰

é‚£å…¶å®è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå³æœ‰ä¸€äº›æ•°æ®å®ƒå¯èƒ½ä¸æ˜¯ä» Node.js å¼€å§‹è°ƒç”¨çš„ï¼Œæ¯”å¦‚è¯´ç›´æ¥ä»æ“ä½œç³»ç»Ÿåº•å±‚é€šçŸ¥åˆ°æˆ‘ä»¬çš„ Node.js ä»£ç å»åšä¸€äº›äº‹æƒ…

é‚£ä¹ˆè¿™æœ‰å•¥ä¾‹å­å¯ä»¥ä½“ç°å‡ºè¿™ä¸€ç‚¹å‘¢ï¼Ÿ

æ‹¿æˆ‘ä»¬ä¹‹å‰çš„çŸ³å¤´å‰ªåˆ€å¸ƒæ¸¸æˆæ¥çœ‹:

``` js
// index.js
const game = require('./game')
let count = 0
process.stdin.on('data', e => {
  const playerAction = e.toString().trim()
  const result = game(playerAction)
  if (result == -1) {
    count++
  }
  if (count === 3) {
    console.log('å¥½å§ï¼äººç±»ï¼Œæ—¢ç„¶æˆ‘è¾“äº†ä¸‰å±€ï¼Œé‚£æˆ‘è®¤è¾“ã€‚')
    process.exit()
  }
})
```

å½“æˆ‘ä»¬ `node index.js` ä¹‹åï¼Œæˆ‘ä¼šåœ¨ç»ˆç«¯é‡Œè¾¹è¾“å…¥ä¸€äº›æ¸¸æˆæ“ä½œï¼Œå¦‚ã€ŒçŸ³å¤´ã€ã€ã€Œå‰ªåˆ€ã€ç­‰ï¼Œç„¶åæ“ä½œç³»ç»Ÿä¼šå¸®æˆ‘æŠŠç»ˆç«¯é‡Œè¾¹æ¥æ”¶åˆ°çš„è¿™äº›ä¿¡æ¯ä¼ åˆ°æˆ‘ä»¬çš„ Node.js é‡Œè¾¹æ¥ï¼Œè€Œåœ¨è¿™ä¸ªè¿‡ç¨‹é‡Œè¾¹ï¼Œå°±ä¼šç”¨åˆ°å¦å¤–ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼Œå«åš `EventEmitter` ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥å¤„ç†äº‹ä»¶çš„æ¨¡å—ï¼

**â¹ï¼š**[Events - Node.js v12.12.0 Documentation](https://nodejs.org/dist/latest-v12.x/docs/api/events.html#events_class_eventemitter)

åœ¨æ–‡æ¡£é‡Œè¾¹ï¼Œå¯ä»¥çœ‹åˆ° `EventEmitter` æ˜¯å±äº `Events` è¿™ä¸ªæ¨¡å—é‡Œè¾¹çš„Class

ç„¶åå®ƒæœ‰è®¸å¤šæ–¹æ³•ï¼Œå…¶ä¸­æœ‰ä¸ªæ–¹æ³• `emitter.addListener(eventName, listener)` ï¼Œæˆ‘æƒ³å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰å§ ï¼è¿™è·Ÿå‰ç«¯é‡Œè¾¹çš„ï¼Œå†™ä¸€äº›äº‹ä»¶ç›‘å¬å™¨ï¼Œå¦‚é¼ æ ‡ç‚¹å‡» `btn.addEventListener('click',callback)` â€¦â€¦æ˜¯éå¸¸ç›¸åƒ
çš„ã€‚

æ€»ä¹‹ï¼Œ `EventEmitter` å®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ `btn.addEventListener('click',callback)` è¿™æ ·ç±»ä¼¼çš„ä¸œè¥¿ï¼Œå³å®ƒå¯ä»¥æŠŠåº•å±‚å‘ç”Ÿçš„ä¸€äº›å˜åŒ–ï¼Œå¦‚å‰ç«¯é‡Œè¾¹çš„é¡µé¢æ¥å—äº†é¼ æ ‡äº‹ä»¶ï¼Œä¼ é€’åˆ°æˆ‘ä»¬çš„å‰ç«¯ä¸Šæ¥ï¼Œç„¶åè®©ä½ å¯ä»¥åšç›¸åº”çš„æ“ä½œï¼

é‚£ä¹ˆ Node.js å…¶å®ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå®ƒé€šè¿‡ `EventEmitter` è¿™ä¸ªæ¨¡å—æ¥åšåˆ°ï¼Œ å®ƒ çš„ `process` å…¨å±€å˜é‡ä¹Ÿæ˜¯ `EventEmitter` çš„ä¸€ä¸ªå®ä¾‹ï¼Œå³processå…¶å®æ˜¯ç»§æ‰¿äº†EventEmitterçš„ï¼Œç„¶å processå°±å…·å¤‡äº†å¾€ä¸ŠæŠ›äº‹ä»¶çš„èƒ½åŠ›ï¼Œè€Œè¿™ä¸ªå¾€ä¸ŠæŠ›äº‹ä»¶çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸ºã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€ï¼Œå°±åƒæˆ‘ä»¬åˆšæ‰è¯´åˆ°å‰ç«¯ä¹Ÿæœ‰ä¸€ä¸ªå¾ˆç»å…¸çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Œé‚£å°±æ˜¯ `addEventListener` å’Œ `removeEventListener` è¿™ä¸¤ä¸ªæ–¹æ³•

ç®€å•æ¥è¯´ï¼Œã€Œè§‚å¯Ÿè€…æ¨¡å¼ã€å°±æ˜¯ä¸€ä¸ª**äº‹ä»¶çš„æ”¶å‘**çš„è¿™ä¹ˆä¸€ä¸ªæ¨¡å¼ï¼

é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°è¿™ç§æ¨¡å¼å‘¢ï¼Ÿâ€”â€”ç›´æ¥ç”¨ä»£ç æ¥æ¼”ç¤ºä¸€ä¸‹ï¼Œå³ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å†™ä¸€äº›ä»€ä¹ˆä¸œè¥¿

éœ€æ±‚ï¼šæå®¢æ—¶é—´å¦‚æœæœ‰ä¸€ä¸ªæ–°çš„è¯¾ç¨‹æ›´æ–°ï¼Œå°±ä¼šé€šçŸ¥åˆ°ä½ ï¼Œç„¶åä½ å°±ä¼šå»è§‚çœ‹å»å­¦ä¹ 

``` js
// index.js
// æŠŠæŠ›äº‹ä»¶çš„æ¨¡å—å°è£…èµ·æ¥
// å¼ºè°ƒæŠ›äº‹ä»¶è¿™ç§æ¨¡å¼æ›´é€‚åˆåº•å±‚æ¨¡å—å¾€å¤–ä¼ é€’ä¿¡æ¯
const geektime = require('./geektime');

geektime.on('newlesson', ({
  price
}) => {
  console.log('yeah! new lesson')
  if (price < 80) {
    console.log('buy')
  }
})

setTimeout(() => {
  // éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒEventEmitterå¦‚æœæ·»åŠ äº†è¿‡å¤šçš„ç›‘å¬å™¨ï¼ŒNode.jsè§‰å¾—ä½ æœ‰å†…å­˜æ³„æ¼å«Œç–‘ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªwarningã€‚
  // ç”¨ä»¥ä¸‹è¿™å¥åˆ™å¯ä»¥æ¶ˆé™¤è¿™ä¸ªé™åˆ¶
  // geektime.setMaxListeners(200);
  for (let i = 0; i < 100; i++) {
    geektime.on('newlesson', ({
      price
    }) => {})
  }
}, 10000)
```

``` js
//geektime.js
const EventEmitter = require('events').EventEmitter;

class Geektime extends EventEmitter {
  constructor() {
    super();

    setInterval(() => {
      this.emit('newlesson', {
        price: Math.random() * 100
      })
    }, 3000)
  }
}

module.exports = new Geektime;
```

`Geektime` è¿™ä¸ªClasså°±æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„äº‹ä»¶æ”¶å‘å™¨å•¦ï¼

> ç”¨åˆ° `this` ï¼Œå¿…é¡»å†™ä¸Š `super()` ã€‚è¿™é‡Œçš„ `this` çš„æŒ‡å‘å°±æ˜¯ `Geektime` å®ä¾‹å“ˆï¼è¯´ç™½äº†ï¼Œ `geektime` å¯¹è±¡ä» EventEmitter å“ªé‡Œç»§æ‰¿äº† `on` ã€ `emit` ç­‰æ–¹æ³•ï¼Œè€Œè¿™è®©æˆ‘ä»¬å…·å¤‡äº†å¯ä»¥è‡ªå®šä¹‰äº‹ä»¶çš„èƒ½åŠ›ï¼å¯¹äº†ï¼Œå¯ä»¥ç›´æ¥è¿™æ · `const EventEmitter = require('events')` ã€‚è¿˜æœ‰ä½  `extend` xxxï¼Œä¸å•åªç»§æ‰¿äº†å®ƒçš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿˜æœ‰å®ƒçš„é™æ€æ–¹æ³•

æµ‹è¯•ï¼š

1. åˆ›å»ºä¸€ä¸ª `Geektime` å®ä¾‹ `geektime` 
2. ä¸º `geektime` å®ä¾‹æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œå³ç›‘å¬ `newlesson` äº‹ä»¶ï¼Œå¦‚æœæœ‰æ–°è¯¾ç¨‹ä¸Šçº¿ï¼Œé‚£å°±åšç‚¹ä»€ä¹ˆæ“ä½œ
3. äº‹ä»¶ç›‘å¬å™¨å¯ä»¥è·å–è¿™ä¸ª `newlesson` äº‹ä»¶è§¦å‘æ‰€æŠ›å‡ºçš„å†…å®¹

æ”¶è·ä»€ä¹ˆï¼š

1. EventEmitterçš„å®ä¾‹ï¼ˆGeektimeç»§æ‰¿è‡ªEventEmitterï¼Œè¯´Geektimeçš„å®ä¾‹ä¸ºEventEmitterçš„å®ä¾‹æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œå› ä¸ºè¿™èƒ½åŠ›å°±æ˜¯ç»§æ‰¿è‡ªventEmitterçš„ï¼‰ï¼Œå®ƒå¯ä»¥ä»»æ„çš„æŠ›ä»»ä½•æ•°æ®å‡ºå»ï¼Œæ€»ä¹‹ï¼Œè¯¥å®ä¾‹å¯ä»¥æŠ›ä»»æ„çš„äº‹ä»¶å‡ºæ¥ï¼Œå¹¶ä¸”å¸¦ç€å®ƒæƒ³è¦ç»™çš„ä¸€äº›å‚æ•°ï¼Œè®©å¤–é¢ç»Ÿç»Ÿå¯ä»¥æ¥æ”¶åˆ°ï¼å›å¿†èµ·ä¹‹å‰æ‰€å†™çš„è¿™ä¸ªä»£ç  `process.stdin.on('data',callback)` , æ˜¾ç„¶å°±å¾ˆå¥½ç†è§£äº†ï¼

ä»¥ä¸Šå°±æ˜¯ EventEmitter çš„ä¸€ä¸ªä½¿ç”¨æ–¹æ³•äº†ï¼Œå³ç”¨å®ƒæ¥å¯ä»¥åšä¸€äº›é€šçŸ¥çš„äº‹æƒ…ï¼

å›è¿‡å¤´æ¥ï¼Œä¸ºå•¥è¦æŠŠ `Geektime` æ”¾åˆ°ä¸€ä¸ªå­æ¨¡å—é‡Œè¾¹ï¼Œç„¶åå†å¯¼å‡ºä¸€ä¸ª Geektimeå®ä¾‹å‡ºæ¥å‘¢ï¼Ÿ

è¿™æ ·åšçš„æ„å›¾æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦æŠŠåº•å±‚çš„ä¸€äº›é€»è¾‘å°è£…èµ·æ¥æ”¾åˆ°å¦å¤–ä¸€ä¸ªæ¨¡å—é‡Œè¾¹ï¼Œç„¶åå¤–è¾¹çš„ä¸šåŠ¡ä»£ç ï¼ˆå¦‚ `index.js` é‡Œè¾¹çš„ä»£ç ï¼‰æ‹¿åˆ°è¿™ä¸ªæ¨¡å—ï¼Œé€šè¿‡äº‹ä»¶çš„ç›‘å¬å™¨ `addListener` , å°±èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿çš„çŸ¥é“å­æ¨¡å—é‡Œè¾¹å‘ç”Ÿçš„ä¸€äº›å˜åŒ–

è€Œè¿™ç§å˜åŒ–ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬çš„ `geektime` å¯¹è±¡å»è°ƒç”¨å¤–è¾¹çš„ä¸€äº›å‡½æ•°ï¼Œåªéœ€è¦å¾€è‡ªå·±èº«ä¸ŠæŠ›ä¸€ä¸ªäº‹ä»¶å°±å¯ä»¥äº†ï¼å³ç›‘å¬ä¸€ä¸ªäº‹ä»¶ç„¶åå†™ä¸Šcallbackå°±å¥½äº†ã€‚

è€Œè¿™æ ·ä¸€ä¸ªåšæ³•ï¼Œæœ€å¤§å¥½å¤„å°±æ˜¯æˆ‘ä»¬å¯ä»¥æ— é™çš„å»æ·»åŠ ç›‘å¬æˆ‘ä»¬æ–°è¯¾ç¨‹çš„äººæ•°ï¼Œç„¶åæˆ‘ä»¬çš„ `Geektime` è¿™ä¸ªç±»å¹¶ä¸éœ€è¦åšä»»ä½•æ”¹å˜ï¼Œè€Œè¿™ä¸ªå°±æ˜¯è®¾è®¡æ¨¡å¼æ‰€è¦è¾¾æˆçš„ä¸€ä¸ªç›®çš„ï¼Œå³æˆ‘ä»¬æ‰©å±•ä¸€äº›é€»è¾‘ï¼Œå®Œå…¨ä¸éœ€è¦æ”¹åŠ¨åˆ°åº•å±‚ï¼Œç„¶åè¿™æ ·å°±å¯ä»¥æé«˜æˆ‘ä»¬ç¨‹åºçš„å¯ç»´æŠ¤æ€§ï¼

### â—‡è§‚å¯Ÿè€…æ¨¡å¼

![1571104369388](img/04/1571104369388.png)

å›è¿‡å¤´æ¥ï¼Œæˆ‘ä»¬äº†è§£äº† `EventEmitter` æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼çš„å®è·µï¼Œè€Œè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ç”¨æ¥è§£å†³ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´é€šä¿¡çš„é—®é¢˜çš„

ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„é€šä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ç›´æ¥çš„å‡½æ•°è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨è§‚å¯Ÿè€…æ¨¡å¼

> å…³äºç›´æ¥çš„å‡½æ•°è°ƒç”¨æ˜¯æ€ä¹ˆç†è§£çš„å‘¢ï¼Ÿ
>
> `person.cut('jj')` çš„æ„æ€æ˜¯è¿™æ ·çš„ï¼š
>
> â‘ ç»™ persom å¯¹è±¡å‘é€äº†ä¸€ä¸ª cut æ¶ˆæ¯
>
> â‘¡person å¯¹è±¡ä¼šå“åº”è¿™ä¸ªæ¶ˆæ¯
>
> æˆ‘ä»¬éƒ½è¯´è¿™æ˜¯å‡½æ•°è°ƒç”¨ï¼Œå…¶å® æ”¹æˆ Smalltalk å°±ç†è§£äº† ï¼š
>
> `person cut: 'jj'` ã€ `person cut: 'jj'; cut: 'hands'` 
>
> è€Œä¸æ˜¯ï¼š `person.cut('jj')` ã€ `person.cut('hands')` 

é‚£ä¹ˆä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨å“ªä¸€ç§å‘¢ï¼Ÿ

ç°åœ¨ç½‘ä¸Šå¾ˆå¤šçš„ä¸€äº›å…³äºè§‚å¯Ÿè€…æ¨¡å¼çš„ä¸¾ä¾‹ï¼Œéƒ½æ¯”è¾ƒå…³æ³¨ã€Œé€šçŸ¥ã€è¿™ä»¶äº‹æƒ…ï¼Œä»–ä»¬è§‰å¾—åªè¦æœ‰ã€Œé€šçŸ¥ã€è¿™ä»¶äº‹æƒ…å°±é€‚åˆç”¨è§‚å¯Ÿè€…æ¨¡å¼

æ¯”å¦‚è¯´è€æ¿ï¼Œé€šçŸ¥ç§˜ä¹¦å»åšä¸€äº›äº‹æƒ…ï¼Œç„¶åä»–ä»¬å°±ä¼šä¸¾ä¾‹è¯´ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°ï¼Œä½†æ˜¯è¿™å…¶å®æ˜¯ä¸é€‚åˆçš„

å› ä¸ºè§‚å¯Ÿè€…æœ‰ä¸€ä¸ªä¸å¥½çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€ŒæŠ›ä¸€ä¸ªäº‹ä»¶ã€ï¼Œå®ƒå…¶å®æ˜¯ä¸çŸ¥é“è¢«æ¥æ”¶è¿™é€šçŸ¥çš„äººæ˜¯è°å“ˆï¼

å¦‚ã€Œè€æ¿é€šçŸ¥ç§˜ä¹¦å»åšä¸€äº›äº‹æƒ…ã€ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°çš„è¯ï¼Œé‚£ä¹ˆè€æ¿åªç®¡æŠ›è¿™ä¹ˆä¸€ä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹ä»¶æœ‰å¯èƒ½ä¸ä»…ä»…è¢«ç§˜ä¹¦çŸ¥é“äº†ï¼Œä¹Ÿæœ‰å¯èƒ½è¢«é—¨å£ä¿å®‰çŸ¥é“äº†ï¼Œå¦‚æœæ¶‰åŠåˆ°å•†ä¸šæœºå¯†ï¼Œé‚£ä¹ˆè¿™å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚

è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯è¯´ï¼Œã€ŒæŠ›äº‹ä»¶ã€è¿™ç§æ–¹å¼æ˜¯ä¸é€‚åˆäºè¯´å½“æ²¡æœ‰äººç›‘å¬è¿™ä¸ªäº‹ä»¶è¿™ä¸ªé€»è¾‘è¿˜èƒ½è·‘ä¸‹å»çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè€æ¿å¦‚æœæŠ›äº†ä¸€ä¸ªäº‹ä»¶ï¼Œä½†æ˜¯ä»–ä¸ç®¡è¿™ä¸ªäº‹ä»¶æœ‰æ²¡æœ‰è¢«ç›‘å¬åˆ°çš„è¯ï¼Œé‚£ä»–æœ‰å¯èƒ½é€šçŸ¥ç§˜ä¹¦åšçš„äº‹æƒ…æ²¡æœ‰å»åšï¼Œé‚£ä¹ˆè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ã€‚

åƒè€æ¿é€šçŸ¥ç§˜ä¹¦è¿™ä»¶äº‹ï¼Œè™½ç„¶æˆ‘ä»¬ç”¨äº†ã€Œé€šçŸ¥ã€äºŒå­—ï¼Œä½†æ˜¯å®ç°è¿™ä¸ªè¿‡ç¨‹æœ€å¥½çš„æ–¹å¼è¿˜æ˜¯ç”¨ã€Œè°ƒç”¨ã€ï¼Œå› ä¸ºè¿™æ ·ä¼šæœ‰æ›´å¥½çš„å¯é æ€§ï¼Œä¹Ÿèƒ½æœ‰æ›´å¥½çš„ç§å¯†æ€§

ã€ŒæŠ›äº‹ä»¶ã€è§‚å¯Ÿè€…æ¨¡å¼è¿™ä¸ªäº‹æƒ…ï¼Œæœ€é€‚ç”¨çš„åœºæ™¯å°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é€šçŸ¥è¿™ä¸ªæ¶ˆæ¯çš„äººï¼Œä»–å¹¶ä¸çŸ¥é“è¢«é€šçŸ¥è€…çš„å­˜åœ¨ï¼Œæ¯”å¦‚è¯´æå®¢æ—¶é—´å¹¶ä¸€å®šçŸ¥é“ä½ çš„å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå’©æœ‰äººæ¥æ”¶è¿™ä¸ªäº‹ä»¶å®ƒè¿˜èƒ½ç»§ç»­ä¸‹å»ï¼Œæ¯”å¦‚è¯´æˆ‘ä»Šå¤©æ²¡æœ‰æ¥æ”¶åˆ°æå®¢æ—¶é—´ä¸Šæ–°è¯¾çš„æ¶ˆæ¯ï¼Œä½†æ˜¯æå®¢æ—¶é—´è¿˜æ˜¯èƒ½ç»§ç»­ä¸Šæ–°è¯¾ï¼Œé‚£è¿™ç§åœºæ™¯å°±æœ€é€‚åˆç”¨æŠ›äº‹ä»¶äº†ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡æŠ›äº‹ä»¶å¾—åˆ°æ›´å¥½çš„å¯æ‰©å±•æ€§ 

è€å¸ˆé€šè¿‡è®²è§£è§‚å¯Ÿè€…æ¨¡å¼ï¼ŒåŠ æ·±äº†æˆ‘ä»¬å¯¹EventEmitterçš„ç†è§£ã€‚æ€»ä¹‹ï¼Œ Node.js çš„å†…ç½®æ¨¡å—åšçš„äº‹æƒ…åŸºæœ¬ä¸Šå°±æ˜¯è´Ÿè´£ Node.js çš„åº”ç”¨å±‚é¢åˆ°æˆ‘ä»¬æ“ä½œç³»ç»Ÿå±‚é¢çš„ä¸€ä¸ªé€šä¿¡ï¼ŒåŒ…æ‹¬ Node.js è°ƒç”¨ OS çš„èƒ½åŠ›ï¼Œæˆ–è€…è¯´ OS é€šçŸ¥  Node.js  çš„èƒ½åŠ›ï¼Œè€Œè¿™äº›éƒ½æ˜¯å†…ç½®æ¨¡å—ä¼šåšçš„äº‹æƒ…ï¼Œé‚£æœ‰äº†å†…ç½®æ¨¡å—ä¹‹åäº†ï¼Œ Node.js å°±æœ‰äº†å¼ºå¤§çš„å’Œæ“ä½œç³»ç»Ÿäº¤äº’çš„èƒ½åŠ›ï¼Œä¹Ÿå°±èƒ½å¤Ÿé¡ºåˆ©çš„åšæˆä¸€ä¸ªæœåŠ¡ç«¯çš„åº”ç”¨ï¼

ä»¥ä¸Šå°±æ˜¯å…³äº Node.js æ¨¡å—çš„å…¨éƒ¨å†…å®¹äº†ï¼Œç»è¿‡å¯¹è¿™éƒ¨åˆ†å†…å®¹çš„ç ”ç©¶ï¼Œæˆ‘ä»¬ä¹Ÿæ˜ç¡®äº† Node.js çš„å…¶ä¸­ä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯å®ƒæ˜¯ä¸€é—¨å…·å¤‡å¯æ‰©å±•æ€§çš„ã€å…¨é¢çš„ï¼Œèƒ½åœ¨æœåŠ¡ç«¯è¿è¡Œçš„ JS æŠ€æœ¯

ä¸‹ä¸€éƒ¨åˆ†ï¼Œå°±æ¥èŠèŠ Node.js çš„å¦ä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯å¼‚æ­¥ï¼Œä»¥åŠå®ƒé€šè¿‡å¼‚æ­¥æ‰€è¾¾æˆçš„é«˜æ€§èƒ½

## â˜…æ‰©å±•é˜…è¯»

**â¹ï¼š**[Vernonè°ˆè½¯ä»¶è®¾è®¡ï¼Œåˆ°åº•æ˜¯è‡ªé¡¶å‘ä¸‹è¿˜æ˜¯è‡ªåº•å‘ä¸Š-InfoQ](https://www.infoq.cn/article/BK-slZpJePA3NuQM7yEp)

**â¹ï¼š**[ç±» - JavaScript - MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Classes)

## æ€»ç»“

* å½“ä½ å¯¹ Node.js  è¿™ä¸ªæ¦‚å¿µäº§ç”Ÿäº†ç–‘æƒ‘ï¼Œé‚£å°±æŠŠå®ƒæ›¿æ¢æˆ æµè§ˆå™¨ï¼Œå³å®ƒæ˜¯ä¸€ä¸ªç¯å¢ƒï¼
* å±‚é¢ï¼š Node.js åº”ç”¨å±‚é¢ã€V8å±‚é¢ã€æ“ä½œç³»ç»Ÿå±‚é¢ï¼Œä¸åŒå±‚é¢ä¹‹é—´å‘ç”Ÿäº¤äº’ã€‚V8å’Œæ“ä½œç³»ç»Ÿå±‚é¢çš„äº¤äº’æ¡¥æ¢æ˜¯ bindingsï¼Œè€Œ Node.js åº”ç”¨å±‚é¢å’ŒV8å±‚é¢çš„äº¤äº’å°±æ˜¯ä½ å†™çš„ JS ä»£ç ï¼
* ä½•æ—¶ç”¨è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿâ€”â€”åªç®¡æŠ›äº‹ä»¶ï¼Œä¸ç†ä¼šæœ‰æ²¡æœ‰äººç›‘å¬è¿™äº‹ä»¶ã€‚å³ä¾¿æ²¡æœ‰äººç›‘å¬ï¼Œè‡ªå·±ä¹Ÿèƒ½å¥½å¥½çš„æ´»ä¸‹å»ã€‚
* CommonJS è§„èŒƒã€å†…ç½®æ¨¡å—ï¼Œè®© Node.js å…·å¤‡é«˜å¯æ‰©å±•æ€§ï¼
* Node.js ç‰›é€¼ï¼

## â˜…Q&A

### â‘ è·¯è¿‡ä¸€å¼ å›¾ï¼š JS å‘å±•ç®€å²ï¼Ÿ

![JavaScript å†å²ï¼ˆNode &amp; Denoï¼‰](img/04/84b35f78e629563f630a517db06d79b6.png)

**â¹ï¼š**[Deno å¹¶ä¸æ˜¯ä¸‹ä¸€ä»£ Node.js - Goè¯­è¨€ä¸­æ–‡ç½‘ - Golangä¸­æ–‡ç¤¾åŒº](https://studygolang.com/articles/13101)

### â‘¡æ“ä½œç³»ç»Ÿæ¶æ„ï¼ŸCPUæ¶æ„ï¼Ÿ

**â¹ï¼š**[å¤„ç†å™¨æ¶æ„ã€æŒ‡ä»¤é›†å’Œæ±‡ç¼–è¯­è¨€ï¼Œä¸‰è€…æœ‰ä½•å…³ç³»ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/23474438)

**â¹ï¼š**[ç†Ÿæ‚‰è®¡ç®—æœºä½“ç³»ç»“æ„æ˜¯ç§ä»€ä¹ˆæ ·çš„ä½“éªŒï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/59057984)

**â¹ï¼š**[å¤„ç†å™¨çš„æ¶æ„ä¼šå¯¹æ“ä½œç³»ç»Ÿäº§ç”Ÿä»€ä¹ˆå½±å“ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/20324698)

**â¹ï¼š**[X86/X64çš„å¤„ç†å™¨å’Œ32/64ä½çš„ç³»ç»Ÿæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/47389187)

**â¹ï¼š**[åº“ï¼Œæ¡†æ¶ï¼Œæ¶æ„ï¼Œå¹³å°ï¼Œæœ‰ä»€ä¹ˆæ˜ç¡®çš„åŒºåˆ«ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/29643471)

**â¹ï¼š**[ç‰å…”å·çš„ SPACEos æ“ä½œç³»ç»Ÿï¼Œç³»ç»Ÿæ¶æ„æ˜¯æ€ä¹ˆè®¾è®¡çš„ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/22346689)

**â¹ï¼š**[åŒæ—¶å…¼å®¹Windowså’ŒLinuxåº”ç”¨è½¯ä»¶æ˜¯å¦å¯èƒ½ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/22360519)

### â‘¢ä½•ä¸ºæ¶æ„ï¼Ÿ

> CPUæ˜¯ä¸€ä¸ªæ‰§è¡Œéƒ¨ä»¶ï¼Œå®ƒä¹‹æ‰€ä»¥èƒ½æ‰§è¡Œï¼Œä¹Ÿæ˜¯å› ä¸ºäººä»¬åœ¨é‡Œé¢åˆ¶ä½œäº†æ‰§è¡Œå„ç§åŠŸèƒ½çš„ç¡¬ä»¶ç”µè·¯ï¼Œç„¶åå†ç”¨ä¸€å®šçš„é€»è¾‘è®©å®ƒæŒ‰ç…§ä¸€å®šçš„é¡ºåºå·¥ä½œï¼Œè¿™æ ·å°±èƒ½å®Œæˆäººä»¬ç»™å®ƒçš„ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŠŠCPUçœ‹ä½œä¸€ä¸ªäººï¼Œé¦–å…ˆå®ƒè¦æœ‰æ­£å¸¸çš„å·¥ä½œèƒ½åŠ›ï¼ˆå³æ‰§è¡Œèƒ½åŠ›ï¼‰ï¼Œç„¶ååˆæœ‰è¶³å¤Ÿçš„é€»è¾‘èƒ½åŠ›ï¼ˆèƒ½æ˜ç™½åšäº‹çš„é¡ºåºï¼‰ï¼Œæœ€åè¿˜è¦å¬çš„æ‡‚åˆ«äººçš„è¯ï¼ˆæ—¢æŒ‡ä»¤é›†ï¼‰ï¼Œæ‰èƒ½æ­£å¸¸å·¥ä½œã€‚è€Œè¿™äº›é›†ä¸­åœ¨ä¸€èµ·å°±æ„æˆäº†æ‰€è°“çš„â€œæ¶æ„â€ï¼Œå®ƒå¯ä»¥ç†è§£ä¸ºä¸€å¥—â€œå·¥å…·â€ã€â€œæ–¹æ³•â€å’Œâ€œè§„èŒƒâ€çš„é›†åˆã€‚ä¸åŒçš„æ¶æ„ä¹‹é—´ï¼Œå·¥å…·å¯èƒ½ä¸åŒï¼Œæ–¹æ³•å¯èƒ½ä¸åŒï¼Œè§„èŒƒä¹Ÿå¯èƒ½ä¸åŒï¼Œè¿™ä¹Ÿé€ æˆäº†å®ƒä»¬ä¹‹é—´çš„ä¸å…¼å®¹â€”â€”ä½ ç»™ä¸€ä¸ªæ„å¤§åˆ©æ³¥ç“¦åŒ çœ‹ä¸€ä»½ä¸­æ–‡å†™æˆçš„çƒ¹é¥ªæŒ‡å—ï¼Œä»–å½“ç„¶ä¸çŸ¥é“åº”è¯¥å¹²ä»€ä¹ˆäº†ã€‚

ä¸€ä¸ªäººè¦èƒ½æ­£å¸¸å·¥ä½œï¼šèƒ½åŠ¨ï¼Œå¹²æ´»æœ‰é¡ºåºï¼Œèƒ½å¬æ‡‚åˆ«äººè¯´ä½ è¯¥æ€ä¹ˆåšã€‚

**â¹ï¼š**[ARMä¸X86ä¸å…·å¤‡å¯æ¯”æ€§ æ€§èƒ½å·®è·å¯å¤§ä¸Šåƒå€ - è§†ç‚¹Â·è§‚å¯Ÿ - cnBeta. COM](https://www.cnbeta.com/articles/tech/167883.htm)

**â¹ï¼š**[X86å’ŒARMæ¶æ„çš„å¤„ç†å™¨èƒ½æ•ˆå·®å¼‚ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆå¤§ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/20148756)

**â¹ï¼š**[ä¸ºä»€ä¹ˆLinus Torvaldsåçˆ±x86è€Œä¸æ˜¯ARMæ¶æ„ - äººç‰© - cnBeta. COM](https://www.cnbeta.com/articles/tech/546655.htm)

### â‘£æˆ‘ç”µè„‘åªæœ‰ä¸€ä¸ªCPUï¼Œä½†æ˜¯æœ‰4ä¸ªæ ¸ï¼Ÿå•¥æ„æ€ï¼Ÿ

ç­”æ¡ˆä¸€ï¼š

> æ‰€è°“çš„å•æ ¸ï¼Œå°±æ˜¯æŒ‡è¿™é¢—CPUé‡Œé¢åªå°è£…äº†ä¸€ä¸ªæ ¸èŠ¯
> è€ŒåŒæ ¸å’Œå››æ ¸ç”šè‡³Næ ¸ï¼Œå…¶å®éƒ½æ˜¯æŒ‡çš„è¿™é¢—CPUé‡Œé¢å°è£…çš„æ ¸å¿ƒæ•°é‡ã€‚
>
> ä½ å¯ä»¥è¿™æ ·ç†è§£ï¼Œä¸¤é¢—é¢‘ç‡ç›¸åŒçš„CPUï¼Œå…¶æ ¸èŠ¯æ•°é‡è¶Šå¤šè¶Šå¥½ï¼Œæ ¸èŠ¯æ•°é‡è¶Šå¤šï¼Œå…¶è®¡ç®—èƒ½åŠ›åŠå¤„ç†çš„çº¿ç¨‹æ•°éƒ½ä¼šè¶Šé«˜ã€‚

ç­”æ¡ˆäºŒï¼š

> æ ¸ï¼Œä½ å¯ä»¥æƒ³è±¡æˆäººè„‘å­ï¼Œä¸€ä¸ªæ ¸å°±æ˜¯ä¸€ä¸ªè„‘å­ï¼Œå››æ ¸å°±è¯´æ˜CPUæœ‰å››ä¸ªè„‘å­ï¼Œè„‘å­è¶Šå¤šè§£å†³é—®é¢˜çš„é€Ÿåº¦è¶Šå¿«ï¼ŒIntelçš„æ ¸æŠ€æœ¯ï¼Œå¯ä»¥æŠŠä¸€ä¸ªæ ¸æ¨¡æ‹Ÿåˆ†æˆä¸¤ä¸ªçº¿ç¨‹æ¥ç”¨ï¼Œå……åˆ†çš„å‘æŒ¥äº†cpuçš„æ€§èƒ½ï¼Œçº¿ç¨‹8å°±ä»£è¡¨æ ¸å¿ƒæ•°æ˜¯4æ ¸çš„å¤„ç†å™¨å¯ä»¥æ¨¡æ‹Ÿå‡º8ä¸ªçº¿ç¨‹æ¥ä½¿ç”¨ã€‚çº¿ç¨‹æˆ‘ä»¬å¯ä»¥ç†è§£æ¯ä¸ªå¤§è„‘åŒæ—¶èƒ½å¤„ç†å¤šå°‘ä»¶äº‹ã€‚

ç­”æ¡ˆä¸‰ï¼š

> æ ¸æ˜¯æŒ‡cpué‡Œå°è£…çš„æ ¸èŠ¯ å•ã€åŒã€å¤šæŒ‡çš„æ˜¯æ ¸å¿ƒçš„æ•°é‡
> é€šå¸¸æ¥è¯´ æ•°é‡è¶Šå¤šå¤„ç†èƒ½åŠ›å°±è¶Šå¼º
> è¡¥å……ä¸€ç‚¹ ä¸åŒçš„åŒæ ¸è¿˜æ˜¯æœ‰åŒºåˆ«çš„
> æ¯”å¦‚è¯´intelçš„åŒæ ¸cpuï¼Œæ˜¯å°†ä¸¤ä¸ªä¸åŒç¡…æ™¶ç‰‡ä¸Šçš„èŠ¯ç‰‡å°è£…åœ¨ä¸€èµ· æˆä¸ºåŒèŠ¯æ›´è´´åˆ‡ä¸€äº›
> amdçš„åŒæ ¸cpuæ˜¯å°†ä¸¤å—èŠ¯ç‰‡åšåœ¨åŒä¸€å—ç¡…æ™¶ç‰‡ä¸Š æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„åŒæ ¸
>
> é‚£å“ªä¸€ç§è®¾è®¡æ›´å¥½ï¼Ÿ
>
> äº‹å®è¯æ˜AMDçš„è®¾è®¡æ›´å¥½ï¼Œä¸è¿‡è¿™æ˜¯è®¸å¤šå¹´å‰çš„è®¾è®¡ã€‚ç°åœ¨éƒ½æ˜¯åœ¨ä¸€å—èŠ¯ç‰‡ä¸Šé¢ã€‚

**â¹ï¼š**[CPUçš„â€œå•æ ¸â€â€œåŒæ ¸â€â€œå››æ ¸â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/20231624)

å€Ÿæ­¤å¼•å‡ºå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼š

**â¹ï¼š**[å¤šæ ¸ CPU å’Œå¤šä¸ª CPU æœ‰ä½•åŒºåˆ«ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/20998226)

ç®€æ´ç­”æ¡ˆï¼š

> å¤šæ ¸CPUå’Œå¤šCPUçš„åŒºåˆ«ä¸»è¦åœ¨äºæ€§èƒ½å’Œæˆæœ¬ã€‚å¤šæ ¸CPUæ€§èƒ½æœ€å¥½ï¼Œä½†æˆæœ¬æœ€é«˜ï¼›å¤šCPUæˆæœ¬å°ï¼Œä¾¿å®œï¼Œä½†æ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚

> ç®€å•è¯´å°±æ˜¯ä¸€å®¶å­äººå¹²æ´»å’Œå‡ å®¶äººå¹²æ´»çš„åŒºåˆ«ï¼Œå‡è®¾æ€»äººæ•°ä¸€æ ·ï¼Œä¸€å®¶äººå¼€ä¸ªé—¨å°±èƒ½åè°ƒï¼Œå‡ å®¶äººå°±è¦è¿‡è¡—æ‰èƒ½å•†é‡

æ‰€ä»¥ï¼š

æˆ‘è¿™å°ç”µè„‘å°±æ˜¯ä¸€ä¸ªCPUèŠ¯ç‰‡ï¼Œä½†å¯ä»¥å®Œæˆè®¡ç®—ä»»åŠ¡æœ‰4ä¸ªå®¶ä¼™ï¼

### â‘¤ è‡ªé¡¶å‘ä¸‹å’Œè‡ªåº•å‘ä¸Š ï¼Ÿ

> å¯¹äº Vernon æ¥è¯´ï¼Œè‡ªé¡¶å‘ä¸‹å’Œè‡ªåº•å‘ä¸Šéƒ½åªæ˜¯å­¦ä¹ å’ŒçŸ¥è¯†æ’åºçš„ç­–ç•¥ï¼Œä¸¤è€…åªæ˜¯ä¸åŒçš„æ€ç»´æ–¹å¼ï¼Œå®ƒä»¬éƒ½éå¸¸æœ‰ç”¨ã€‚è‡ªé¡¶å‘ä¸‹çš„æ€è€ƒä¸»è¦æ˜¯åŸºäºæˆ‘ä»¬å·²ç»çŸ¥é“çš„ä¸œè¥¿ã€‚è‡ªé¡¶å‘ä¸‹å°±åƒé€æ­¥åˆ†æ‹†é—®é¢˜ï¼Œè€Œæ¯ä¸ªé—®é¢˜å°±åƒä¸€ä¸ªå†…å®¹æœªçŸ¥çš„é»‘ç›’å­ã€‚ä½†åˆ†æ‹†åˆ°ä¸€å®šç¨‹åº¦ï¼Œæˆ‘ä»¬ä¼šé™·å…¥å›°å¢ƒï¼Œè¿™æ—¶å€™å°±å¿…é¡»è½¬æ¢åˆ°è‡ªåº•å‘ä¸Šçš„è§†è§’ï¼Œå°è¯•å‘ç°æˆ‘ä»¬ä¸çŸ¥é“çš„ä¸œè¥¿ã€‚ç°åœ¨æˆ‘ä»¬åªæ˜¯åœ¨å¼€å‘è½¯ä»¶çš„ä¸€å°éƒ¨åˆ†ï¼ˆå®ƒä»¬å¯ä»¥æˆä¸ºå‚ä¸è€…ï¼‰ï¼Œæœ€ç»ˆå®ƒä¼šæˆä¸ºä¸€ä¸ªæ›´å¤§çš„ç³»ç»Ÿä¸­çš„å­ç³»ç»Ÿï¼ŒVernon è®¤ä¸ºè¿™æ˜¯ä¸€ç§æµ®ç°å¼è®¾è®¡ã€‚ 

åœ¨çœ‹æŸä¸ªå†…ç½®æ¨¡å—çš„æºç å®ç°çš„æ—¶å€™ï¼Œä» Node.js åº”ç”¨å±‚é¢ï¼Œåˆ°åº•å±‚C++ä»£ç 

æ€ç»´ï¼šæ‹†åµŒå¥—å¾ˆå¤šå±‚çš„ç›’å­ï¼Œåƒåˆ°xxxå±‚ç›’å­çš„æ—¶å€™ï¼Œå‘ç°æ— æ³•ç»§ç»­ä¸‹å»äº†ï¼Œé‚£ä¹ˆèƒ½å¦ä»æ ¸å¿ƒå¾€ä¸Šæ€è€ƒäº†ï¼Ÿå³ç»“æœå¯¼å‘ä»£ç å®ç°æˆ–è€…è¯´è¡Œä¸ºå®ç°

**â¹ï¼š**[Vernonè°ˆè½¯ä»¶è®¾è®¡ï¼Œåˆ°åº•æ˜¯è‡ªé¡¶å‘ä¸‹è¿˜æ˜¯è‡ªåº•å‘ä¸Š-InfoQ](https://www.infoq.cn/article/BK-slZpJePA3NuQM7yEp)

### â‘¥äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ï¼Ÿ

 åœ¨æˆ‘ä»¬ä½¿ç”¨Javaï¼ŒPHPç­‰è¯­è¨€å®ç°ç¼–ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯å®Œç¾çš„ç¼–ç¨‹è®¾è®¡ï¼Œè¿™ä½¿å¾—ä»–ä»¬å¯¹å…¶ä»–ç¼–ç¨‹æ–¹æ³•ä¸å±‘ä¸€é¡¾ã€‚å´ä¸çŸ¥å¤§åé¼é¼Nodeä½¿ç”¨çš„å´æ˜¯äº‹ä»¶é©±åŠ¨ç¼–ç¨‹çš„æ€æƒ³ã€‚

é‚£ä»€ä¹ˆæ˜¯äº‹ä»¶é©±åŠ¨ç¼–ç¨‹å‘¢ï¼Ÿ

> **äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ï¼Œä¸ºéœ€è¦å¤„ç†çš„äº‹ä»¶ç¼–å†™ç›¸åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚ä»£ç åœ¨äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œã€‚**  

ä¸ºéœ€è¦å¤„ç†çš„äº‹ä»¶ç¼–å†™ç›¸åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚è¦ç†è§£äº‹ä»¶é©±åŠ¨å’Œç¨‹åºï¼Œå°±éœ€è¦ä¸éäº‹ä»¶é©±åŠ¨çš„ç¨‹åºè¿›è¡Œæ¯”è¾ƒã€‚

å®é™…ä¸Šï¼Œç°ä»£çš„ç¨‹åºå¤§å¤šæ˜¯äº‹ä»¶é©±åŠ¨çš„ï¼Œæ¯”å¦‚å¤šçº¿ç¨‹çš„ç¨‹åºï¼Œè‚¯å®šæ˜¯äº‹ä»¶é©±åŠ¨çš„ã€‚æ—©æœŸåˆ™å­˜åœ¨è®¸å¤šéäº‹ä»¶é©±åŠ¨çš„ç¨‹åºï¼Œè¿™æ ·çš„ç¨‹åºï¼Œåœ¨éœ€è¦ç­‰å¾…æŸä¸ªæ¡ä»¶è§¦å‘æ—¶ï¼Œä¼šä¸æ–­åœ°æ£€æŸ¥è¿™ä¸ªæ¡ä»¶ï¼Œç›´åˆ°æ¡ä»¶æ»¡è¶³ï¼Œè¿™æ˜¯å¾ˆæµªè´¹cpuæ—¶é—´çš„ã€‚è€Œäº‹ä»¶é©±åŠ¨çš„ç¨‹åºï¼Œåˆ™æœ‰æœºä¼šé‡Šæ”¾cpuä»è€Œè¿›å…¥ç¡çœ æ€ï¼ˆæ³¨æ„æ˜¯æœ‰æœºä¼šï¼Œå½“ç„¶ç¨‹åºä¹Ÿå¯è‡ªè¡Œå†³å®šä¸é‡Šæ”¾cpuï¼‰ï¼Œå½“äº‹ä»¶è§¦å‘æ—¶è¢«æ“ä½œç³»ç»Ÿå”¤é†’ï¼Œè¿™æ ·å°±èƒ½æ›´åŠ æœ‰æ•ˆåœ°ä½¿ç”¨cpuã€‚  

> è½®è¯¢å¤ªè´¹ç²¾åŠ›äº†ã€‚å¦‚ä¸æ–­åœ°çœ‹æŸä¸ªåŠ¨æ¼«æ›´æ–°äº†æ²¡ï¼Ÿé‚£ä¹ˆèƒ½å¦æœ‰å¦ä¸€ç§å§¿åŠ¿è®©æˆ‘çŸ¥é“åŠ¨æ¼«å·²ç»æ›´æ–°äº†å‘¢ï¼Ÿ

 æ¥çœ‹ä¸€å¼ ç®€å•çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼ˆè‰å›¾ï¼‰ï¼š 

![1571106204793](img/04/1571106204793.png)

äº‹ä»¶é©±åŠ¨æ¨¡å‹ä¸»è¦åŒ…å«3ä¸ªå¯¹è±¡ï¼šäº‹ä»¶æºã€äº‹ä»¶å’Œäº‹ä»¶å¤„ç†ç¨‹åºã€‚

* äº‹ä»¶æºï¼šäº§ç”Ÿäº‹ä»¶çš„åœ°æ–¹(htmlå…ƒç´ )
* äº‹ä»¶ï¼šç‚¹å‡»/é¼ æ ‡æ“ä½œ/é”®ç›˜æ“ä½œç­‰ç­‰
* äº‹ä»¶å¯¹è±¡ï¼šå½“æŸä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œè¯¥äº‹ä»¶å¯¹è±¡ä¼šå°è£…å¥½è¯¥äº‹ä»¶çš„ä¿¡æ¯ï¼Œä¼ é€’ç»™äº‹ä»¶å¤„ç†ç¨‹åº
* äº‹ä»¶å¤„ç†ç¨‹åºï¼šå“åº”ç”¨æˆ·äº‹ä»¶çš„ä»£ç  

> äº‹ä»¶æºï¼šåœ¨æŸä¸ªå­æ¨¡å—é‡Œè¾¹ï¼Œæœ‰ä¸ªç»§æ‰¿äº† EventEmitter çš„å¯¹è±¡å®ä¾‹ geektime
>
> äº‹ä»¶ï¼šgeektimeä¸»åŠ¨è§¦å‘äº†äº‹ä»¶xxx
>
> äº‹ä»¶å¯¹è±¡ï¼šæ²¡æœ‰å‘€! å°±å¸¦äº†ä¸€ä¸ªå‚æ•°ä¸Šæ¥
>
> äº‹ä»¶å¤„ç†ç¨‹åºï¼š Node.js åº”ç”¨å±‚é¢ï¼Œç›‘å¬xxxäº‹ä»¶æ—¶ï¼Œæ‰€ä¼ çš„callback

å…¶å®æˆ‘ä»¬ä½¿ç”¨çš„windowç³»ç»Ÿä¹Ÿç®—å¾—ä¸Šæ˜¯äº‹ä»¶é©±åŠ¨äº†ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„äº‹ä¾‹ï¼šç›‘å¬é¼ æ ‡ç‚¹å‡»äº‹ä»¶ï¼Œå¹¶èƒ½å¤Ÿæ˜¾ç¤ºé¼ æ ‡ç‚¹å‡»çš„ä½ç½®x, yã€‚ 

``` html
<html>

<head>
  <script>
    function test1(e) {
      window.alert( `(x,y)ğŸ‘‰ğŸ‘‰ğŸ‘‰(${e.clientX},${e.clientY})` );
    }
  </script>
</head>

<body onmousedown="test1(event)">
</body>

</html>
```

> è§¦å‘ä¸€ä¸ªäº‹ä»¶çš„ç›´é¢æ„Ÿå—æ˜¯ç”¨æˆ·ä¸æµè§ˆå™¨çš„ç•Œé¢äº¤äº’ï¼Œä½†æœ¬è´¨éƒ½æ˜¯ç¨‹åºä¸ç¨‹åºä¹‹é—´çš„äº¤äº’ï¼æˆ–è€…è¯´ä¸»ç¨‹åºä¸å­ç¨‹åºä¹‹é—´çš„äº¤äº’ï¼

**â¹ï¼š**[node.jsåŸºæœ¬å·¥ä½œåŸç†åŠæµç¨‹ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘](https://cloud.tencent.com/developer/article/1037475)

### â‘¦ Node.js åº•å±‚æœºåˆ¶ï¼Ÿ

> nodejsä½œä¸ºjavascriptåœ¨åç«¯è¿è¡Œçš„ç¯å¢ƒï¼Œæºç ç”±jsä¸Cå®Œæˆã€‚æœ¬è´¨ä¸Šï¼Œnodejsæ˜¯å€ŸåŠ©äºè°·æ­ŒV8å¼•æ“æ¥è¿è¡Œjavascriptä»£ç ã€‚ä½¿ç”¨äº†Cçš„libuvåº“æ¥å¤„ç†ç½‘ç»œï¼Œè®¿é—®æ–‡ä»¶ç³»ç»Ÿç­‰æ“ä½œã€‚

**nodejsçš„ä½œç”¨:**

1. æä¾›ä¸€ç§æ¥å£ï¼Œä»…ä»…ä¹¦å†™javascriptçš„ä»£ç ï¼Œå°±å¯ä»¥è®©ä»–ä»¬æ­£ç¡®æ‰§è¡Œï¼Œä¸ç”¨ä¹¦å†™C++ä»£ç ã€‚

2. ä¸°å¯Œçš„apiã€‚httpã€fsã€pathã€crypto â€¦modules

**nodejsæºç ï¼š**

* lib:nodejsåº“å‡½æ•°
* src: åº“å‡½æ•°çš„C++å®ç°ã€‚

internalBindingé“¾æ¥ JS ä»£ç ä¸ C++ ä»£ç 

**V8ï¼š**

å°†JSç±»å‹è½¬æ¢ä¸ºc++ç±»å‹

``` c++
using v8:: Array; 
using v8:: ArrayBuffer; 
using v8:: Boolean; 
using v8:: Context; 
using v8:: Float64Array; 
using v8:: FunctionCallbackInfo; 
using v8:: Int32; 
using v8:: Integer; 
using v8:: Isolate; 
using v8:: Local; 
using v8:: MaybeLocal; 
using v8:: NewStringType; 
using v8:: Null; 
using v8:: Number; 
using v8:: Object; 
using v8:: String; 
using v8:: Value; 

```

**libuvï¼š**

å¤„ç†å¹¶å‘æ“ä½œ

``` c++
uv_free_cpu_info(cpu_infos, count);
args.GetReturnValue().Set(Array::New(isolate, result.data(), result.size()));
```

**â¹ï¼š**[æ·±åº¦ç†è§£nodejs[1]-nodeåº•å±‚æœºåˆ¶ - éƒ‘å»ºå‹‹çš„ä¸ªäººç½‘ç«™](https://dreamerjonson.com/2018/11/08/%E6%B7%B1%E5%BA%A6%E7%90%86%E8%A7%A3nodejs/)

